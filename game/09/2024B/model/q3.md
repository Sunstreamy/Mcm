### **3.3 问题三：复杂生产流程的全局最优决策模型**

为解决图1所示的多阶段、高维度生产决策问题，我们摒弃了存在“组合爆炸”风险的枚举法，选择构建一个基于**图论**与**动态规划 (Dynamic Programming, DP)** 的全局优化模型。该模型不仅能高效地找出最优策略，还能提供深刻的管理洞察。

#### **3.3.1 模型框架与符号体系**

我们将生产流程抽象为一个**有向无环图 (DAG)**，并采用逆向递推策略求解。为清晰阐述模型，我们首先定义表3-1所示的符号体系。

**表3-1：问题三模型核心符号定义**
| 类别 | 符号 | 含义 |
| :--- | :--- | :--- |
| **集合与索引** | `j` | 图中的任一节点（代表任一零件、半成品或成品） |
| | `k` | 特指零配件节点（叶子节点） |
| | `Par(j)`| 节点`j`的所有直接上游父节点`i`的集合 |
| **状态变量** | `C_j^*` | 获得一个合格节点`j`的**最小期望总成本**（模型核心） |
| **基础参数** | `c_{b,j}` | 节点`j`的采购成本（若为零件）或装配成本 |
| | `c_{t,j}` | 节点`j`的检测成本 |
| | `c_{d,j}` | 节点`j`的拆解成本 |
| | `p_j` | 节点`j`的原始次品率（若为零件`p_k`）或工艺次品率（`p_{a,j}`） |
| | `L` | 最终成品的市场调换损失 |
| **中间变量** | `P_{g,j}` | 节点`j`的单次装配成功率 |
| | `P_{d,j}` | 节点`j`的单次装配失败率，`P_{d,j} = 1 - P_{g,j}` |
| | `V_j` | 拆解不合格节点`j`可回收的期望价值 |

#### **3.3.2 动态规划状态转移方程**

DP模型的核心是状态转移方程，它定义了如何从上游节点的最优状态 `C_i^*` 推导出当前节点的最优状态 `C_j^*`。

**1. 基础节点（零配件 `k`）**

对于生产流程的起点（叶子节点），其最小期望成本 `C_k^*` 由“检”与“不检”两种决策的成本决定：
$$
C_k^* = \min \left( c_{b,k}, \frac{c_{b,k} + c_{t,k}}{1 - p_k} \right) \quad \cdots \quad (1)
$$

**2. 聚合节点（半成品/成品 `j`）**

对于由上游组件装配而成的聚合节点`j`，其最优成本`C_j^*`是所有可能决策下成本的最小值。

$$
C_j^* = \min \{ C_{ts}(j), C_{td}(j), C_{nt}(j) \} \quad \cdots \quad (2)
$$
其中，`C_{ts}(j)`, `C_{td}(j)`, `C_{nt}(j)` 分别代表“检+报废”、“检+拆解”和“不检”三种决策下的期望成本。

为计算这些成本，我们首先定义**期望上游成本 `C_{up}(j)`**：
$$
C_{up}(j) = \sum_{i \in Par(j)} C_i^* \quad \cdots \quad (3)
$$
这里的`C_i^*`是已在上一阶段计算出的、父节点`i`的最优成本。

*   **决策一：检测并报废 `C_{ts}(j)` (重试模型)**
    $$
    C_{ts}(j) = \frac{C_{up}(j) + c_{b,j} + c_{t,j}}{P_{g,j}} \quad \cdots \quad (4)
    $$
    此公式的物理意义是：单次尝试的全部投入成本（分子）除以成功率（分母），即为获得一个成功品的期望总投入。

*   **决策二：检测并拆解 `C_{td}(j)` (返工模型)**
    $$
    C_{td}(j) = C_{up}(j) + \frac{c_{b,j} + c_{t,j} + P_{d,j} \cdot (c_{d,j} - V_j)}{P_{g,j}} \quad \cdots \quad (5)
    $$
    此公式将成本分解为：一次性的上游成本 `C_{up}(j)`，和可重复的“装配-检测-拆解”循环的期望成本（分数项）。其中，期望回收价值`V_j`的计算基准为上游组件的最优成本`C_i^*`。

*   **决策三：不检测 `C_{nt}(j)` (市场风险模型，仅适用于最终成品)**
    $$
    C_{nt}(j) = \frac{C_{up}(j) + c_{b,j} + P_{d,j} \cdot (L + C_{ret}^*) }{P_{g,j}} \quad \cdots \quad (6)
    $$
    此公式将市场调换损失`L`和最优退货处理成本`C_{ret}^*`作为风险成本，计入总期望成本中。

#### **3.3.3 模型求解与策略构建**

我们通过编写一个递归的、带记忆化功能的程序来实现上述DP模型。
1.  **求解**: 从根节点（最终成品 `F`）调用求解函数，该函数将递归地、逆向地计算图中所有节点的 `C_j^*` 值。
2.  **回溯**: 当所有 `C_j^*` 计算完毕后，我们从根节点 `F` 开始，根据每一步计算中记录的最优决策 `d_j^*`，正向回溯，最终构建出一条贯穿所有节点的、唯一的**全局最优决策链**。

该模型最终输出的，不仅是全局最小期望成本，更是一套清晰的、覆盖所有生产环节的“最优操作规程”，为企业提供了极高的决策价值。